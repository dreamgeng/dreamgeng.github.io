<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>初识MySQL | dreamgeng</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">初识MySQL</h1><a id="logo" href="/.">dreamgeng</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">初识MySQL</h1><div class="post-meta">Jan 21, 2019<span> | </span><span class="category"><a href="/categories/Python/">Python</a></span></div><div class="post-content"><h2 id="MySQL的存储"><a href="#MySQL的存储" class="headerlink" title="MySQL的存储"></a>MySQL的存储</h2><h3 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h3><p>关系型数据库是基于关系模型的数据库，而关系模型是通过二维表来保存的，所以它的存储方式就是行列组成的表，每一列是一个字段，每一行是一条记录。表可以看作某个实体的集合，而实体之间存在联系，这就需要表与表之间的关联关系来体现，如主键外键的关联关系。多个表组成一个数据库，也就是关系型数据库。</p>
<p>关系型数据库有多种，如SQLite、MySQL、Oracle、SQL Server、DB2等。</p>
<p>今天主要学习的是Python 3下MySQL的存储。</p>
<h3 id="Python-3下与Python-2下的区别"><a href="#Python-3下与Python-2下的区别" class="headerlink" title="Python 3下与Python 2下的区别"></a>Python 3下与Python 2下的区别</h3><p>在Python 2中，连接MySQL的库大多是使用MySQLdb，但是此库的官方并不支持Python 3，所以在Python 3下主要是用PyMySQL操作MySQL数据库。</p>
<h3 id="那么如何使用PyMySQL操作MySQL数据库呢？"><a href="#那么如何使用PyMySQL操作MySQL数据库呢？" class="headerlink" title="那么如何使用PyMySQL操作MySQL数据库呢？"></a>那么如何使用PyMySQL操作MySQL数据库呢？</h3><h4 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h4><h5 id="安装MySQL数据库"><a href="#安装MySQL数据库" class="headerlink" title="安装MySQL数据库"></a>安装MySQL数据库</h5><p>（我用的安装环境是ubuntu16.04，所以只介绍此系统下的安装方法，win或Mac下的安装方法可以Google安装）</p>
<p>ubuntu16.04下可以直接用<code>apt-get</code>命令即可安装MySQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. sudo apt-get <span class="keyword">update</span></span><br><span class="line"><span class="number">2.</span> sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> -y mysql-<span class="keyword">server</span> mysql-<span class="keyword">client</span></span><br></pre></td></tr></table></figure>
<p>启动、关闭和重启MySQL服务的命令如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. sudo<span class="built_in"> service </span>mysql start</span><br><span class="line">2. sudo<span class="built_in"> service </span>mysql stop</span><br><span class="line">3. sudo<span class="built_in"> service </span>mysql restart</span><br></pre></td></tr></table></figure>
<p>安装完成后修改密码，输入：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql -uroot -p</span></span><br></pre></td></tr></table></figure>
<p>输入密码后，进入MySQL命令行模式，接着输入如下命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> mysql;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">Password</span> = <span class="keyword">PASSWORD</span>(<span class="string">'newpass'</span>) <span class="keyword">WHERE</span> <span class="keyword">user</span> = <span class="string">'root'</span>;</span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure>
<p>其中，其中<code>newpass</code>为修改的新的MySQL密码，可以自行修改。</p>
<p>最后，退出命令行可以输入：<code>exit()</code> ，回车即可。</p>
<h5 id="PyMySQL的安装"><a href="#PyMySQL的安装" class="headerlink" title="PyMySQL的安装"></a>PyMySQL的安装</h5><p>这里我是使用pip3安装:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 <span class="keyword">install</span> pymysql</span><br></pre></td></tr></table></figure>
<h4 id="2-创建数据库"><a href="#2-创建数据库" class="headerlink" title="2. 创建数据库"></a>2. 创建数据库</h4><p>代码如下：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过connect()方法声明一个MySQL对象db</span></span><br><span class="line"><span class="attr">db</span> = pymysql.connect(<span class="attr">host='localhost',</span>  <span class="comment"># 本地ip</span></span><br><span class="line">                     <span class="attr">user='root',</span>  <span class="comment"># 用户名</span></span><br><span class="line">                     <span class="attr">password='*********',</span>  <span class="comment"># 数据库密码</span></span><br><span class="line">                     <span class="attr">port=3306)</span>  <span class="comment"># 默认端口</span></span><br><span class="line"><span class="comment"># 用cursor()方法获取操作游标，游标就相当于一个缓冲区，存放暂时的结果，利用游标来执行SQL语句</span></span><br><span class="line"><span class="attr">cursor</span> = db.cursor()</span><br><span class="line"><span class="comment"># 使用execute()方法执行</span></span><br><span class="line">cursor.execute('SELECT VERSION()')</span><br><span class="line"><span class="comment"># 调用fetchone()方法获取第一条数据</span></span><br><span class="line"><span class="attr">data</span> = cursor.fetchone()</span><br><span class="line">print('Database version:', data)</span><br><span class="line"><span class="comment"># 创建数据库的操作，数据库名为spiders，默认编码为utf-8</span></span><br><span class="line">cursor.execute(<span class="string">"CREATE DATABASE spiders DEFAULT  CHARACTER SET utf8"</span>)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<p>一般创建数据库只需要执行一次即可。</p>
<h4 id="3-创建表"><a href="#3-创建表" class="headerlink" title="3. 创建表"></a>3. 创建表</h4><p>新建一个数据表<code>students</code>代码如下：</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host='localhost',</span><br><span class="line">                     user='root',</span><br><span class="line">                     password='*********',</span><br><span class="line">                     port=<span class="number">3306</span>,</span><br><span class="line">                     db='spiders')  <span class="meta"># 在链接数据库时需要额外指定一个参数db</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"><span class="meta"># 新建数据表students,其中id和name的类型都是varchar，age类型int</span></span><br><span class="line">sql = '<span class="keyword">CREATE</span> TABLE <span class="keyword">IF</span> <span class="keyword">NOT</span> EXISTS students (id VARCHAR(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="built_in">NULL</span>, name VARCHAR (<span class="number">255</span>) <span class="keyword">NOT</span> <span class="built_in">NULL</span>, age INT <span class="keyword">NOT</span> <span class="built_in">NULL</span>, PRIMARY <span class="built_in">KEY</span> (id))'</span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure>
<h4 id="4-静态插入数据"><a href="#4-静态插入数据" class="headerlink" title="4. 静态插入数据"></a>4. 静态插入数据</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id = <span class="string">'20120003'</span></span><br><span class="line">user = <span class="string">'Mary'</span></span><br><span class="line">age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'*********'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line"><span class="built_in">cursor</span> = db.<span class="built_in">cursor</span>()</span><br><span class="line"># 首先构造一个sql语句，直接用格式化符%s来表示，有几个<span class="built_in">values</span>就有几个%s</span><br><span class="line">sql = <span class="string">'INSERT INTO students(id, name, age) values(%s, %s, %s)'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql, (id, user, age)):</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">'Successful'</span>)</span><br><span class="line">        # 注意：最后需要执行commit()方法才可真正实现把数据插入</span><br><span class="line">        db.commit()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Failed'</span>)</span><br><span class="line">    # 最后执行一个异常处理，调用rollback()实现数据回滚，相当于什么都没有发生过</span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure>
<h4 id="5-动态插入数据"><a href="#5-动态插入数据" class="headerlink" title="5. 动态插入数据"></a>5. 动态插入数据</h4><p>静态插入数据时，有一个极其不方便的地方，比如突然增加了性别字段<code>gender</code>，此时SQL语句就需要改成：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students(id, name, age, gender) <span class="built_in">values</span>(<span class="built_in">%s</span>, <span class="built_in">%s</span>, <span class="built_in">%s</span>, <span class="built_in">%s</span>)</span><br></pre></td></tr></table></figure>
<p>而且相应的元组需要改成：</p>
<figure class="highlight hy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">id</span></span>, name, age, gender)</span><br></pre></td></tr></table></figure>
<p>显然这种方法操作起来很繁琐，那么有没有一种方法可以直接插入呢？</p>
<p>这时我们可以构造一个动态的字典就可以了。</p>
<p>代码如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 构造一个动态字典</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20120002'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Mike'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'*********'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line"><span class="built_in">cursor</span> = db.<span class="built_in">cursor</span>()</span><br><span class="line"># 表名定义长table</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line"># 这里涉及了<span class="keyword">join</span>的用法，需要可自行Google</span><br><span class="line"># 将data的键值用<span class="string">', '</span>隔开</span><br><span class="line"><span class="built_in">keys</span> = <span class="string">', '</span>.<span class="keyword">join</span>(data.<span class="built_in">keys</span>())</span><br><span class="line"># 构造%s占位符，个数等于data的长度</span><br><span class="line"><span class="built_in">values</span> = <span class="string">', '</span>.<span class="keyword">join</span>([<span class="string">'%s'</span>] * <span class="built_in">len</span>(data))</span><br><span class="line"># 最后利用字符串的format()方法将表名、字段名和占位符构造出来</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;)'</span>.format(table=table, <span class="built_in">keys</span>=<span class="built_in">keys</span>, <span class="built_in">values</span>=<span class="built_in">values</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	# 第二个参数是data键值组成的元组</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql, tuple(data.<span class="built_in">values</span>())):</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">'Successful'</span>)</span><br><span class="line">        db.commit()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Failed'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.<span class="keyword">close</span>()</span><br></pre></td></tr></table></figure>
<p>最后，SQL语句动态构造成了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(<span class="keyword">id</span>, <span class="keyword">name</span>, age) <span class="keyword">VALUES</span> (%s, %s, %s)</span><br></pre></td></tr></table></figure>
<h4 id="6-更新数据"><a href="#6-更新数据" class="headerlink" title="6. 更新数据"></a>6. 更新数据</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'20120001'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Bob'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'*********'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line"><span class="built_in">cursor</span> = db.<span class="built_in">cursor</span>()</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line"><span class="built_in">keys</span> = <span class="string">', '</span>.<span class="keyword">join</span>(data.<span class="built_in">keys</span>())</span><br><span class="line"><span class="built_in">values</span> = <span class="string">', '</span>.<span class="keyword">join</span>([<span class="string">'%s'</span>] * <span class="built_in">len</span>(data))</span><br><span class="line"></span><br><span class="line"># 实际是在插入后面加入ON DUPLICATE KEY UPDATE ，意思是如果主键已经存在就执行更新操作，若不存在则插入</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;) ON DUPLICATE KEY UPDATE'</span>.format(table=table, <span class="built_in">keys</span>=<span class="built_in">keys</span>,</span><br><span class="line">                                                                                     <span class="built_in">values</span>=<span class="built_in">values</span>)</span><br><span class="line"><span class="keyword">update</span> = <span class="string">','</span>.<span class="keyword">join</span>([<span class="string">" &#123;key&#125; = %s"</span>.format(key=key) <span class="keyword">for</span> key in data])</span><br><span class="line">sql += <span class="keyword">update</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	# 元组×<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql, tuple(data.<span class="built_in">values</span>()) * <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">'Successful'</span>)</span><br><span class="line">        db.commit()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Failed'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.<span class="keyword">close</span>()</span><br></pre></td></tr></table></figure>
<h4 id="7-删除数据"><a href="#7-删除数据" class="headerlink" title="7. 删除数据"></a>7. 删除数据</h4><p>删除直接使用DELETE语句即可，只需要指定目标表名和删除条件，同样需要commit()方法。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">table</span> = <span class="string">'students'</span></span><br><span class="line"><span class="attr">condition</span> = <span class="string">'age &lt; 20'</span></span><br><span class="line"><span class="attr">sql</span> = <span class="string">'DELETE FROM  &#123;table&#125; WHERE &#123;condition&#125;'</span>.format(table=table, condition=condition)</span><br></pre></td></tr></table></figure>
<h4 id="8-查询数据"><a href="#8-查询数据" class="headerlink" title="8. 查询数据"></a>8. 查询数据</h4><p>查询用到SELECT语句，但是不再需要commit()方法了</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">table = <span class="string">'students'</span></span><br><span class="line"># 指定查询条件</span><br><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;= 20'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql)</span><br><span class="line">    # 调用rowcount属性，获取查询结果的条数</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Count:'</span>, <span class="built_in">cursor</span>.rowcount)</span><br><span class="line">    one = <span class="built_in">cursor</span>.fetchone()</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'One:'</span>, one)</span><br><span class="line">    # fetchall()方法获取查询的所有结果</span><br><span class="line">    results = <span class="built_in">cursor</span>.fetchall()</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Results:'</span>, results)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Results Type:'</span>, <span class="built_in">type</span>(results))</span><br><span class="line">    # 查询结果是元组类型，通过遍历打印出来</span><br><span class="line">    <span class="keyword">for</span> row in result<span class="variable">s:</span></span><br><span class="line">        <span class="keyword">print</span>(row)</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>
<p>这里有一个需要注意的点：</p>
<p><code>fetchall()</code>的内部实现有一个偏移指针用来指向查询结果，最开始偏移指针指向第一条数据，取一次之后，指针偏移到下一条数据，这样再取的话，就会取到下一条数据了。我们最初调用了一次<code>fetchone()</code>方法，这样结果的偏移指针就指向下一条数据，<code>fetchall()</code>方法返回的是偏移指针指向的数据一直到结束的所有数据。</p>
<p>此外，我们还可以用<code>while</code>循环加<code>fetchone()</code>方法来获取所有数据，而不是用<code>fetchall()</code>全部一起获取出来。<code>fetchall()</code>会将结果以元组形式全部返回，如果数据量很大，那么占用的开销会非常高。</p>
<p>如下使用<code>while</code>循环加<code></code>fetchone()`方法来获取所有数据：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;= 20'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">cursor</span>.<span class="keyword">execute</span>(sql)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Count:'</span>, <span class="built_in">cursor</span>.rowcount)</span><br><span class="line">    row = <span class="built_in">cursor</span>.fetchone()</span><br><span class="line">    <span class="keyword">while</span> ro<span class="variable">w:</span></span><br><span class="line">        <span class="keyword">print</span>(<span class="string">'Row:'</span>, row)</span><br><span class="line">        row = <span class="built_in">cursor</span>.fetchone()</span><br><span class="line">excep<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>
<p>这样每循环一次，指针就会偏移一条数据，随用随取，简单高效。</p>
</div><div class="tags"><a href="/tags/2019-01/">2019.01</a></div><div class="post-nav"><a class="pre" href="/2019/01/23/分析Ajax爬取今日头条街拍美图/">分析Ajax爬取今日头条街拍美图</a><a class="next" href="/2019/01/20/pycharm配置python解释器/">pycharm配置python解释器</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/myblog/">myblog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/爬虫/">爬虫</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/2019-01/" style="font-size: 15px;">2019.01</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/23/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/23/分析Ajax爬取今日头条街拍美图/">分析Ajax爬取今日头条街拍美图</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/21/初识MySQL/">初识MySQL</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/20/pycharm配置python解释器/">pycharm配置python解释器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/抓取猫眼Top100/">抓取猫眼Top100</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/12/廖雪峰实战day-2/">廖雪峰实战day-2</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/12/在ubuntu上搭建HEXO博客/">在ubuntu上搭建HEXO博客</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/dreamgeng/" title="Github" target="_blank">Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">dreamgeng.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>